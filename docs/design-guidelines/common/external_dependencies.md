# Внешние зависимости и границы

## Цель

Зафиксировать, какие внешние проекты использует `codexctl`, где проходит граница ответственности и как обеспечивается совместимость.

## Основные внешние зависимости

1. Kubernetes
   - назначение: применение манифестов, ожидание rollout, хранение state, исполнение в кластере;
   - интерфейс: kubectl/API через инфраструктурный adapter.
2. GitHub
   - назначение: Issue/PR automation, review flows, комментарии, ветки;
   - интерфейс: GitHub API/CLI через отдельный adapter.
3. `yaml-mcp-server`
   - назначение: MCP-gateway с YAML DSL и approval-chain.
   - роль `codexctl`: сформировать корректный MCP-конфиг и передать его агенту.
4. `telegram-approver`
   - назначение: approval-подтверждения через Telegram.
   - роль `codexctl`: не дергать напрямую; учитывать его контракт через `yaml-mcp-server` конфигурацию и timeout-политику.

## Правила границ

- Не дублировать в `codexctl` бизнес-логику approval и MCP-инструментов.
- Не копировать контракты внешних проектов в виде "магических" строк по коду.
- Интеграционные значения (URL, headers, env refs, timeout) задаются декларативно.
- Секреты хранятся вне репозитория и прокидываются через env/secret management.

## Обязательные интеграционные инварианты

- Для MCP-серверов задается явный timeout (`tool_timeout_sec`) под длительность операции.
- Для всех внешних вызовов определены таймауты и поведение при недоступности.
- Логи не содержат секретов, токенов, приватных payload.
- Ошибки внешних зависимостей нормализуются в стабильные ошибки orchestration-слоя.

## Политика изменений внешних контрактов

При изменениях в `yaml-mcp-server` или `telegram-approver`, влияющих на `codexctl`:

1. Обновить разделы совместимости в `go/cross_repo_compatibility.md`.
2. Обновить примеры и описание интеграции в README.
3. Добавить/обновить интеграционные тест-кейсы или smoke checks.
