# Принципы проектирования (эталон)

## Базовые принципы

Обязательные принципы для `codexctl`:

- SOLID
- DRY
- KISS
- Clean Architecture
- Fail Fast + Explicit Contracts

## SOLID для CLI-оркестратора

- SRP: одна команда или модуль отвечает за один сценарий оркестрации.
- OCP: новые сценарии добавляются через новые use-case/адаптеры, а не через разрастание условных блоков.
- LSP: интерфейсы адаптеров взаимозаменяемы (например, реальный и тестовый Kubernetes adapter).
- ISP: интерфейсы узкие, под конкретный сценарий, без god-interface.
- DIP: прикладной слой зависит от интерфейсов, не от `exec.Command` и конкретных CLI утилит.

## DRY

- Одинаковые последовательности шагов оркестрации должны жить в одном месте.
- Валидация env/флагов, retry-политики, timeout-политики и error mapping не дублируются.
- Повторяемые куски workflow-логики выносятся в reusable workflows.

## KISS

- Сценарии должны быть линейными и читаемыми.
- Любая абстракция должна сокращать сложность, а не прятать ее.
- Если простое решение надежнее и прозрачнее, оно предпочтительнее.

## Clean Architecture

- Core и application не импортируют инфраструктурные детали.
- Инфраструктурные реализации подключаются только на внешнем уровне.
- Все side effects происходят через явные порты и адаптеры.

## Контрактность и обратная совместимость

- CLI-флаги и `CODEXCTL_*` env — публичный контракт.
- Формат `services.yaml` — публичный контракт.
- Reusable workflows и их входы/secrets — публичный контракт.

Любое breaking изменение должно сопровождаться:

- планом миграции;
- обновлением README и гайдов;
- явной фиксацией несовместимости.
