# Пакетный дизайн Go-кода (эталон)

## Цель

Задать целевую структуру кода, к которой должны вести все новые изменения.

## Целевые зоны

1. `internal/cli`
   - только CLI-транспорт: команды, флаги, env binding, вывод;
   - без инфраструктурной логики и тяжелой оркестрации.
2. `internal/application`
   - use-case сценарии (apply, ensure-ready, cleanup, prompt run, review apply);
   - orchestration и координация адаптеров;
   - без знания конкретных внешних библиотек/утилит.
3. `internal/core`
   - инварианты и доменные политики CLI;
   - чистая логика без side effects.
4. `internal/adapters/*`
   - инфраструктурные реализации портов (kube, github, process, state, prompt-config).

## Правила модульности

- Один пакет = одна ответственность.
- Пакеты не должны формировать циклические зависимости.
- Входные DTO CLI отделены от внутренних командных моделей use-case слоя.
- Инфраструктурные ошибки не "протекают" напрямую в пользовательский вывод.

## Политика рефакторинга

Если текущий код не совпадает с целевой моделью:

- разрешается временное использование промежуточных адаптеров и фасадов;
- новые изменения обязаны уменьшать связность и дублирование;
- запрещено добавлять новую функциональность в зоны, известные как архитектурный долг,
  если это усиливает расхождение с эталоном.

## Запреты

- Логика сценария в `main.go`.
- Прямые `exec.Command` в core/application.
- Смешивание рендера конфигурации и побочных вызовов к внешним системам в одном модуле.
- Неявные глобальные зависимости через package-level state.
