# Обработка ошибок (эталон)

## Базовая модель

- Ошибка возвращается вверх до границы сценария.
- Логирование ошибки выполняется один раз на верхней границе команды/use-case.
- Нижние слои добавляют только осмысленный контекст через wrapping.

## Границы и ответственность

- `core`: формирует typed errors предметной логики CLI.
- `application`: нормализует ошибки адаптеров в сценарные ошибки.
- `cli`: маппит ошибки в понятный пользовательский вывод и код завершения.
- `adapters`: не формируют пользовательские сообщения, а возвращают технически точные ошибки.

## Typed errors

Использовать typed errors для устойчивого ветвления:

- invalid input
- not found
- conflict
- external unavailable
- timeout/canceled

Запрещено:

- ветвление по строке ошибки;
- возврат "сырых" stderr сообщений без контекста;
- смешивание форматирования пользовательского вывода внутри adapter-кода.

## Внешние зависимости

Для ошибок Kubernetes/GitHub/Shell:

- сохранять первопричину;
- добавлять контекст операции (что делали, где, с каким идентификатором);
- маскировать чувствительные значения в тексте ошибки.

## Panic policy

- `panic` не используется для ожидаемых сценариев.
- Нарушения инвариантов должны приводить к диагностируемой ошибке на границе.
- Если recovery используется, это делается централизованно и с понятным логом.
