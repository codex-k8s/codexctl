# Точки расширения провайдеров

## Цель

Зафиксировать, как добавлять новые платформенные реализации без изменений в use-case коде.

## Именованные провайдеры

Рекомендуемый подход:

- `orchestrator.provider`: `kubernetes` | `docker-compose` | ...
- `repository.provider`: `github` | `gitlab` | ...

Выбор провайдера выполняется в composition root.

## Требования к новому `Orchestrator` провайдеру

- Реализует контракт `Orchestrator` полностью.
- Поддерживает идемпотентные `Apply/Delete`.
- Поддерживает `WaitReady` с timeout и диагностикой.
- Возвращает ошибки в унифицированном виде для use-case слоя.

## Требования к новому `Repository` провайдеру

- Реализует контракт `Repository` полностью.
- Поддерживает эквивалент операций issue/merge request/review/comments/branches.
- Нормализует provider-specific коды и статусы в общий контракт.

## Mapping-слой

Для каждого провайдера должен быть явный mapping:

- provider DTO <-> внутренние модели `codexctl`;
- provider ошибки <-> внутренние typed errors.

Запрещено использовать provider DTO напрямую в use-case слое.

## Тестирование расширений

- Контрактные тесты для `Orchestrator` и `Repository` обязательны.
- Новый провайдер должен проходить тот же набор контрактных тестов, что и базовый.
- Интеграционные smoke тесты для минимального end-to-end сценария обязательны.
